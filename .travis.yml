language: perl

os:
    - linux
#    - osx

sudo: true

#fast_finish: true

install: "echo"
dist: trusty

addons:
  apt:
    packages:
        - libappstream0
        - libappstream-dev
        - gir1.2-appstream
        - appstream-index

script:
    - chmod +x build-appimage.sh
    - ./build-appimage.sh
    - APPIMAGE="$(find . -name '*.AppImage')"
    - echo "Testing launching scripts from a relative location" && eval "$APPIMAGE t/00-exists.t"
#    - eval "APPIMAGE_DEBUG=1 $(find . -name '*.AppImage') -e 'use Terminal::ANSIColor; say colored(‘what a lovely colours!’, ‘underline red on_green’);" || pwd; ls -lh

branches:
   only:
     - /.*/

notifications:
  irc:
    channels:
      - "irc.freenode.net#perl6-dev"
    on_success: never
    on_failure: never
    template:
      - "Rakudo build %{result}. %{author} '%{commit_message}'"
      - "%{build_url} %{compare_url}"

env:
    - BLEAD=1
    - madeupenvvar=0
    #- RAKUDO_OPTIONS="--backends=moar --gen-nqp        --gen-moar"
    #- RAKUDO_OPTIONS="--backends=moar --gen-nqp=master --gen-moar"
    #- RAKUDO_OPTIONS="--backends=moar --gen-nqp=master --gen-moar=master"
    #- RAKUDO_OPTIONS="--backends=jvm  --gen-nqp"
    #- RAKUDO_OPTIONS="--backends=jvm  --gen-nqp=master"

matrix:
  allow_failures:
    #- env: RAKUDO_OPTIONS="--backends=jvm  --gen-nqp"
#    - env: RAKUDO_OPTIONS="--backends=jvm  --gen-nqp=master"
